{% load crm_extras %}

<tr id="row-{{ row_obj.id }}">
  {% for key in column_keys %}
    <td>
      {% if key in editable_fields and key in form.fields %}
        {% with field=form|get_item:key %}
          {{ field }}
          {% if field.errors %}
            <div style="color:red;">{{ field.errors }}</div>
          {% endif %}
        {% endwith %}
      {% else %}
        {{ row_obj|get_attr:key }}
      {% endif %}
    </td>
  {% endfor %}

  <td>
    <button
      type="button"
      hx-post="{% url 'table_row_save' selected.key row_obj.id %}"
      hx-target="#row-{{ row_obj.id }}"
      hx-swap="outerHTML"
      hx-include="#row-{{ row_obj.id }} input, #row-{{ row_obj.id }} select, #row-{{ row_obj.id }} textarea">
      Save
    </button>

    <button
      type="button"
      hx-get="{% url 'table_row_display' selected.key row_obj.id %}"
      hx-target="#row-{{ row_obj.id }}"
      hx-swap="outerHTML">
      Cancel
    </button>
  </td>
</tr>
