{% extends "base.html" %}
{% block title %}{% if mode == "add" %}Add Question{% else %}Edit Question{% endif %}{% endblock %}

{% block content %}
<h1 class="mb-3">
  {% if mode == "add" %}Add Question{% else %}Edit Question{% endif %}
  <span class="text-muted" style="font-size: 16px;">— {{ form_def.name }}</span>
</h1>

<form method="post" class="card p-3 shadow-sm" style="max-width: 800px;">
  {% csrf_token %}

  <div class="mb-3">
    <label class="form-label">Label</label>
    {{ form.label }}
    {% if form.label.errors %}<div class="text-danger">{{ form.label.errors }}</div>{% endif %}
  </div>

  <div class="mb-3">
    <label class="form-label">Key (optional)</label>
    {{ form.key }}
    <div class="form-text">Leave blank to auto-generate from label (e.g. “Blood Pressure” → “blood-pressure”).</div>
    {% if form.key.errors %}<div class="text-danger">{{ form.key.errors }}</div>{% endif %}
  </div>

  <div class="row g-3">
    <div class="col-md-6">
      <label class="form-label">Type</label>
      {{ form.field_type }}
      {% if form.field_type.errors %}<div class="text-danger">{{ form.field_type.errors }}</div>{% endif %}
    </div>

    <div class="col-md-6 d-flex align-items-center">
      <div class="form-check mt-4">
        {{ form.required }}
        <label class="form-check-label">Required</label>
      </div>
    </div>
  </div>

  <div class="mt-3" id="choices-wrap" style="display:none;">
    <label class="form-label">Choices (one per line)</label>
    {{ form.choices_text }}
    <div class="form-text">Only used when Type = Choice.</div>
    {% if form.choices_text.errors %}<div class="text-danger">{{ form.choices_text.errors }}</div>{% endif %}
  </div>

  <div class="d-flex gap-2 mt-4">
    <button class="btn btn-primary" type="submit">
      {% if mode == "add" %}Add{% else %}Save{% endif %}
    </button>
    <a class="btn btn-outline-secondary" href="{% url 'questions_list' form_def.id %}">Cancel</a>
  </div>
</form>

<script>
  function toggleChoices() {
    const sel = document.getElementById("id_field_type");
    const wrap = document.getElementById("choices-wrap");
    if (!sel || !wrap) return;
    wrap.style.display = (sel.value === "choice") ? "block" : "none";
  }

  document.addEventListener("DOMContentLoaded", function () {
    toggleChoices();
    const sel = document.getElementById("id_field_type");
    if (sel) sel.addEventListener("change", toggleChoices);
  });
</script>
{% endblock %}
